<!-- Subjects Section -->
<div class="flex flex-col gap-4">
  <!-- Liste des subjects -->
  @if (tempSubjects().length > 0) {
  <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
    @for (subject of tempSubjects(); track subject.tempId; let i = $index) {
    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 flex flex-col gap-2">
      <div class="flex items-start justify-between">
        <div class="flex-1">
          <h3 class="font-semibold text-gray-900">{{ subject.name }}</h3>
          <p class="text-sm text-gray-600">
            {{ 'subjects.types.' + subject.type | transloco }}
          </p>
        </div>
        <div class="flex gap-1">
          <button
            type="button"
            (click)="onEditSubject(i)"
            class="p-1.5 text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
            [attr.aria-label]="'subjects.edit' | transloco"
          >
            <i class="pi pi-pencil text-xs"></i>
          </button>
          <button
            type="button"
            (click)="onDeleteSubject(i)"
            class="p-1.5 text-gray-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2"
            [attr.aria-label]="'subjects.delete' | transloco"
          >
            <i class="pi pi-trash text-xs"></i>
          </button>
        </div>
      </div>
      @if (subject.breed || subject.age) {
      <div class="flex gap-3 text-sm text-gray-600">
        @if (subject.breed) {
        <span>{{ 'subjects.form.breed' | transloco }}: {{ subject.breed }}</span>
        } @if (subject.age) {
        <span>{{ 'subjects.form.age' | transloco }}: {{ subject.age }}</span>
        }
      </div>
      } @if (subject.specialNeeds) {
      <p class="text-sm text-gray-600">
        <strong>{{ 'subjects.form.specialNeeds' | transloco }}:</strong>
        {{ subject.specialNeeds }}
      </p>
      }
    </div>
    }
  </div>
  }

  <!-- Bouton ajouter -->
  <button
    type="button"
    (click)="onAddSubject()"
    class="inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold rounded-lg transition-all duration-200 shadow-md hover:shadow-lg"
  >
    <i class="pi pi-plus text-sm" aria-hidden="true"></i>
    <span>{{ 'subjects.addSubject' | transloco }}</span>
  </button>

  <!-- Modale formulaire subject -->
  <p-dialog
    [(visible)]="showSubjectForm"
    [modal]="true"
    [closable]="true"
    [dismissableMask]="true"
    [draggable]="false"
    [resizable]="false"
    styleClass="w-full max-w-2xl"
    (onHide)="onCancelSubjectForm()"
  >
    <ng-template pTemplate="header">
      <h2 class="text-2xl font-bold">
        <span class="bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
          {{
            (editingSubjectIndex() !== null ? 'subjects.editSubject' : 'subjects.addSubject')
              | transloco
          }}
        </span>
      </h2>
    </ng-template>

    <div class="flex flex-col gap-4 py-4" [formGroup]="subjectForm">
      <!-- Type -->
      <div class="flex flex-col gap-2">
        <label for="subject-type" class="font-medium text-gray-700 text-sm">
          {{ 'subjects.form.type' | transloco }}
          <span class="text-red-500" aria-hidden="true">*</span>
        </label>
        <p-select
          id="subject-type"
          formControlName="type"
          [options]="subjectTypes"
          optionLabel="label"
          optionValue="value"
          [placeholder]="'subjects.form.typePlaceholder' | transloco"
          class="w-full"
          aria-required="true"
          [attr.aria-invalid]="subjectForm.controls.type.invalid && subjectForm.controls.type.touched ? 'true' : 'false'"
          [attr.aria-describedby]="subjectForm.controls.type.invalid && subjectForm.controls.type.touched ? 'type-error' : null"
        >
          <ng-template pTemplate="selectedItem" let-selectedOption>
            @if (selectedOption) {
            {{ selectedOption.label | transloco }}
            }
          </ng-template>
          <ng-template pTemplate="item" let-option>
            {{ option.label | transloco }}
          </ng-template>
        </p-select>
        @if (subjectForm.controls.type.invalid && subjectForm.controls.type.touched) {
        <p-message id="type-error" severity="error" variant="simple">
          {{ 'subjects.form.typeRequired' | transloco }}
        </p-message>
        }
      </div>

      <!-- Name -->
      <div class="flex flex-col gap-2">
        <label for="subject-name" class="font-medium text-gray-700 text-sm">
          {{ 'subjects.form.name' | transloco }}
          <span class="text-red-500" aria-hidden="true">*</span>
        </label>
        <input
          pInputText
          id="subject-name"
          formControlName="name"
          [placeholder]="'subjects.form.namePlaceholder' | transloco"
          class="w-full"
          aria-required="true"
          required
          [attr.aria-invalid]="subjectForm.controls.name.invalid && subjectForm.controls.name.touched ? 'true' : 'false'"
          [attr.aria-describedby]="subjectForm.controls.name.invalid && subjectForm.controls.name.touched ? 'name-error' : null"
        />
        @if (subjectForm.controls.name.invalid && subjectForm.controls.name.touched) {
        <p-message id="name-error" severity="error" variant="simple">
          {{ 'subjects.form.nameRequired' | transloco }}
        </p-message>
        }
      </div>

      <!-- Breed & Age -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="flex flex-col gap-2">
          <label for="subject-breed" class="font-medium text-gray-700 text-sm">
            {{ 'subjects.form.breed' | transloco }}
          </label>
          <input
            pInputText
            id="subject-breed"
            formControlName="breed"
            [placeholder]="'subjects.form.breedPlaceholder' | transloco"
            class="w-full"
          />
        </div>

        <div class="flex flex-col gap-2">
          <label for="subject-age" class="font-medium text-gray-700 text-sm">
            {{ 'subjects.form.age' | transloco }}
          </label>
          <p-inputNumber
            id="subject-age"
            formControlName="age"
            [min]="0"
            [placeholder]="'subjects.form.agePlaceholder' | transloco"
            class="w-full"
          />
        </div>
      </div>

      <!-- Special Needs -->
      <div class="flex flex-col gap-2">
        <label for="subject-specialNeeds" class="font-medium text-gray-700 text-sm">
          {{ 'subjects.form.specialNeeds' | transloco }}
        </label>
        <textarea
          pTextarea
          id="subject-specialNeeds"
          formControlName="specialNeeds"
          [placeholder]="'subjects.form.specialNeedsPlaceholder' | transloco"
          rows="2"
          class="w-full"
        ></textarea>
      </div>

      <!-- Notes -->
      <div class="flex flex-col gap-2">
        <label for="subject-notes" class="font-medium text-gray-700 text-sm">
          {{ 'subjects.form.notes' | transloco }}
        </label>
        <textarea
          pTextarea
          id="subject-notes"
          formControlName="notes"
          [placeholder]="'subjects.form.notesPlaceholder' | transloco"
          rows="2"
          class="w-full"
        ></textarea>
      </div>

    </div>

    <ng-template pTemplate="footer">
      <div class="flex justify-end gap-3">
        <app-action-button
          [route]="null"
          type="button"
          labelKey="common.cancel"
          variant="secondary"
          (click)="onCancelSubjectForm()"
        />
        <app-action-button
          [route]="null"
          type="button"
          labelKey="common.save"
          icon="pi-check"
          [disabled]="subjectForm.invalid"
          (click)="onSaveSubject()"
        />
      </div>
    </ng-template>
  </p-dialog>
</div>
