<section class="p-8 bg-gray-50 min-h-full" aria-labelledby="client-form-title">
  <!-- Header -->
  <header class="mb-8">
    <h1 id="client-form-title" class="text-4xl font-bold mb-2">
      <span class="bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
        {{ 'clients.createClient' | transloco }}
      </span>
    </h1>
    <p class="text-gray-600 text-lg">
      {{ 'clients.form.createSubtitle' | transloco }}
    </p>
  </header>

  <!-- Form Card -->
  <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-8 max-w-4xl">
    <form
      [formGroup]="form"
      (ngSubmit)="onSubmit()"
      class="flex flex-col gap-6"
      aria-labelledby="client-form-title"
    >
      <fieldset class="flex flex-col gap-6 border-0 p-0">
        <!-- Client Name -->
        <div class="flex flex-col gap-2">
          <label for="name" class="font-medium text-gray-700">
            {{ 'clients.form.name' | transloco }}
            <span class="text-red-500" aria-hidden="true">*</span>
          </label>
          <input
            pInputText
            id="name"
            formControlName="name"
            autocomplete="name"
            [placeholder]="'clients.form.namePlaceholder' | transloco"
            class="w-full"
            aria-required="true"
            required
            [attr.aria-invalid]="form.controls.name.invalid && form.controls.name.touched ? 'true' : 'false'"
            [invalid]="form.controls.name.invalid && form.controls.name.touched"
            [attr.aria-describedby]="
              form.controls.name.invalid && form.controls.name.touched ? 'name-error' : null
            "
          />
          @if (form.controls.name.invalid && form.controls.name.touched) {
          <p-message id="name-error" severity="error" variant="simple">
            {{ 'clients.form.nameRequired' | transloco }}
          </p-message>
          }
        </div>

        <!-- Address -->
        <div class="flex flex-col gap-2">
          <label for="address" class="font-medium text-gray-700">
            {{ 'clients.form.address' | transloco }}
            <span class="text-red-500" aria-hidden="true">*</span>
          </label>
          <input
            pInputText
            id="address"
            formControlName="address"
            autocomplete="street-address"
            [placeholder]="'clients.form.addressPlaceholder' | transloco"
            class="w-full"
            aria-required="true"
            required
            [attr.aria-invalid]="form.controls.address.invalid && form.controls.address.touched ? 'true' : 'false'"
            [invalid]="form.controls.address.invalid && form.controls.address.touched"
            [attr.aria-describedby]="
              form.controls.address.invalid && form.controls.address.touched
                ? 'address-error'
                : null
            "
          />
          @if (form.controls.address.invalid && form.controls.address.touched) {
          <p-message id="address-error" severity="error" variant="simple">
            {{ 'clients.form.addressRequired' | transloco }}
          </p-message>
          }
        </div>
      </fieldset>

      <!-- Address Details -->
      <fieldset class="grid grid-cols-1 md:grid-cols-2 gap-4 border-0 p-0">
        <div class="flex flex-col gap-2">
          <label for="city" class="font-medium text-gray-700">
            {{ 'clients.form.city' | transloco }}
            <span class="text-red-500" aria-hidden="true">*</span>
          </label>
          <input
            pInputText
            id="city"
            formControlName="city"
            autocomplete="address-level2"
            [placeholder]="'clients.form.cityPlaceholder' | transloco"
            class="w-full"
            aria-required="true"
            required
            [attr.aria-invalid]="form.controls.city.invalid && form.controls.city.touched ? 'true' : 'false'"
            [invalid]="form.controls.city.invalid && form.controls.city.touched"
            [attr.aria-describedby]="
              form.controls.city.invalid && form.controls.city.touched ? 'city-error' : null
            "
          />
          @if (form.controls.city.invalid && form.controls.city.touched) {
          <p-message id="city-error" severity="error" variant="simple">
            {{ 'clients.form.cityRequired' | transloco }}
          </p-message>
          }
        </div>

        <div class="flex flex-col gap-2">
          <label for="postalCode" class="font-medium text-gray-700">
            {{ 'clients.form.postalCode' | transloco }}
            <span class="text-red-500" aria-hidden="true">*</span>
          </label>
          <input
            pInputText
            id="postalCode"
            formControlName="postalCode"
            autocomplete="postal-code"
            [placeholder]="'clients.form.postalCodePlaceholder' | transloco"
            class="w-full"
            aria-required="true"
            required
            [attr.aria-invalid]="form.controls.postalCode.invalid && form.controls.postalCode.touched ? 'true' : 'false'"
            [invalid]="form.controls.postalCode.invalid && form.controls.postalCode.touched"
            [attr.aria-describedby]="
              form.controls.postalCode.invalid && form.controls.postalCode.touched
                ? 'postalCode-error'
                : null
            "
          />
          @if (form.controls.postalCode.invalid && form.controls.postalCode.touched) {
          <p-message id="postalCode-error" severity="error" variant="simple">
            {{ 'clients.form.postalCodeRequired' | transloco }}
          </p-message>
          }
        </div>
      </fieldset>

      <!-- State & Country -->
      <fieldset class="grid grid-cols-1 md:grid-cols-2 gap-4 border-0 p-0">
        <div class="flex flex-col gap-2">
          <label for="state" class="font-medium text-gray-700">
            {{ 'clients.form.state' | transloco }}
          </label>
          <input
            pInputText
            id="state"
            formControlName="state"
            [placeholder]="'clients.form.statePlaceholder' | transloco"
            class="w-full"
          />
        </div>

        <div class="flex flex-col gap-2">
          <label for="country" class="font-medium text-gray-700">
            {{ 'clients.form.country' | transloco }}
            <span class="text-red-500" aria-hidden="true">*</span>
          </label>
          <input
            pInputText
            id="country"
            formControlName="country"
            autocomplete="country-name"
            [placeholder]="'clients.form.countryPlaceholder' | transloco"
            class="w-full"
            aria-required="true"
            required
            [attr.aria-invalid]="form.controls.country.invalid && form.controls.country.touched ? 'true' : 'false'"
            [invalid]="form.controls.country.invalid && form.controls.country.touched"
            [attr.aria-describedby]="
              form.controls.country.invalid && form.controls.country.touched
                ? 'country-error'
                : null
            "
          />
          @if (form.controls.country.invalid && form.controls.country.touched) {
          <p-message id="country-error" severity="error" variant="simple">
            {{ 'clients.form.countryRequired' | transloco }}
          </p-message>
          }
        </div>
      </fieldset>

      <!-- Notes -->
      <fieldset class="flex flex-col gap-2 border-0 p-0">
        <label for="notes" class="font-medium text-gray-700">
          {{ 'clients.form.notes' | transloco }}
        </label>
        <textarea
          pTextarea
          id="notes"
          formControlName="notes"
          [placeholder]="'clients.form.notesPlaceholder' | transloco"
          rows="4"
          class="w-full"
        ></textarea>
      </fieldset>

      <!-- Subjects Section (composant enfant) -->
      <fieldset class="flex flex-col gap-4 border-0 p-0">
        <app-subjects-manager
          [clientId]="null"
          (subjectsChange)="onSubjectsChange($event)"
        />
      </fieldset>

      <!-- Actions -->
      <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
        <app-action-button
          [route]="null"
          type="submit"
          labelKey="common.save"
          icon="pi-check"
          [loading]="clientStore.loading()"
          ariaLabelKey="common.saveClient"
        />
      </div>

      <!-- Global Error -->
      @if (clientStore.error()) {
      <p-message severity="error" class="w-full" variant="simple">
        {{ clientStore.error() }}
      </p-message>
      }
    </form>
  </div>
</section>
