<div class="flex items-center justify-center min-h-screen bg-gray-100">
  <p-card class="w-full max-w-md" role="main" aria-labelledby="login-title">
    <!-- Header -->
    <ng-template pTemplate="header">
      <div class="text-center p-4">
        <h1 id="login-title" class="text-2xl font-bold text-gray-800">{{ 'common.appName' | transloco }}</h1>
        <p class="text-gray-600 mt-2">{{ 'auth.login.title' | transloco }}</p>
      </div>
    </ng-template>

    <!-- Étape 1 : Envoi du code OTP -->
    @if (!otpSent()) {
      <form [formGroup]="emailForm" (ngSubmit)="sendOtp()">
        <div class="flex flex-col gap-4">
          
          <!-- Champ email -->
          <div class="flex flex-col gap-2">
            <label for="email" class="font-semibold text-gray-700">{{ 'auth.login.emailLabel' | transloco }}</label>
            <input
              pInputText
              id="email"
              type="email"
              formControlName="email"
              [placeholder]="'auth.login.emailPlaceholder' | transloco"
              class="w-full"
              autocomplete="email"
              required
              aria-required="true"
              [attr.aria-disabled]="isLoading() ? 'true' : null"
              [attr.aria-invalid]="errorMessage() ? 'true' : null"
              [attr.aria-describedby]="errorMessage() ? 'email-hint email-error' : 'email-hint'"
            />
          </div>

          <!-- Message d'erreur -->
          @if (errorMessage()) {
            <p-message
              id="email-error"
              severity="error"
              role="alert"
              aria-live="polite"
              variant="simple"
            >
              {{ errorMessage() }}
            </p-message>
          }

          <!-- Bouton principal -->
          <p-button
            [label]="'auth.login.sendCodeButton' | transloco"
            icon="pi pi-envelope"
            type="submit"
            [loading]="isLoading()"
            styleClass="w-full"
          />

          <!-- Indication -->
          <span id="email-hint" class="text-sm text-gray-600 text-center mt-2">
            {{ 'auth.login.emailHint' | transloco }}
          </span>
        </div>
      </form>
    }

    <!-- Étape 2 : Vérification du code OTP -->
    @else {
      <form [formGroup]="otpForm" (ngSubmit)="verifyOtp()">
        <div class="flex flex-col gap-4">

          <!-- Informations -->
          <div class="text-center">
            <i class="pi pi-envelope text-4xl text-blue-500 mb-3" aria-hidden="true"></i>
            <h2 class="text-lg font-semibold text-gray-800">{{ 'auth.otp.codeSentTitle' | transloco }}</h2>
            <p class="text-gray-600 mt-2" id="otp-description">
              {{ 'auth.otp.codeSentMessage' | transloco }}<br />
              <strong>{{ emailForm.value.email }}</strong>
            </p>
          </div>

          <!-- Champ OTP -->
          <div class="flex flex-col gap-2">
            <label for="otp-input" class="font-semibold text-gray-700 text-center">
              {{ 'auth.otp.codeLabel' | transloco }}
            </label>
            <div class="flex justify-center">
              <p-inputOtp
                inputId="otp-input"
                formControlName="otpCode"
                [length]="6"
                [integerOnly]="true"
                [attr.aria-disabled]="isLoading() ? 'true' : null"
                aria-describedby="otp-description otp-expiry"
                [invalid]="errorMessage() ? true : false"
              />
            </div>
          </div>

          <!-- Message d'erreur -->
          @if (errorMessage()) {
            <p-message
              severity="error"
              role="alert"
              aria-live="polite"
              variant="simple"
            >
              {{ errorMessage() }}
            </p-message>
          }

          <!-- Bouton principal -->
          <p-button
            [label]="'auth.otp.verifyButton' | transloco"
            icon="pi pi-check"
            type="submit"
            [loading]="isLoading()"
            styleClass="w-full"
          />

          <!-- Actions secondaires -->
          <div class="flex flex-col gap-2 mt-2">
            <p-button
              [label]="'auth.otp.resendButton' | transloco"
              severity="secondary"
              [loading]="isLoading()"
              (onClick)="sendOtp()"
              styleClass="w-full"
              [text]="true"
            />

            <p-button
              [label]="'auth.otp.changeEmailButton' | transloco"
              severity="secondary"
              (onClick)="resetForm()"
              styleClass="w-full"
              [text]="true"
            />
          </div>

          <!-- Information d'expiration -->
          <span id="otp-expiry" class="text-xs text-gray-500 text-center mt-2">
            {{ 'auth.otp.expiryInfo' | transloco }}
          </span>
        </div>
      </form>
    }
  </p-card>
</div>