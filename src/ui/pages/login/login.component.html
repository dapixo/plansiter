<div
  class="flex items-center justify-center min-h-screen bg-gradient-to-br from-primary-50 via-white to-purple-50"
>
  <div class="w-full max-w-md px-4">
    <!-- Card moderne avec ombre douce -->
    <div
      class="bg-white rounded-2xl shadow-xl p-8 sm:p-10"
      role="main"
      aria-labelledby="login-title"
    >
      <!-- Header -->
      <div class="text-center mb-8">
        @if (!otpSent()) {
        <!-- Logo texte stylisé -->
        <h1 id="login-title" class="text-4xl font-bold mb-2">
          <span class="text-primary-500">Plan</span><span class="text-surface-950">Sitter</span>
        </h1>
        <p class="text-gray-600 text-base">
          {{ 'auth.login.title' | transloco }}
        </p>
        } @else {
        <h1 id="login-title" class="text-3xl font-bold text-gray-900 mb-2">
          {{ 'auth.otp.codeSentTitle' | transloco }}
        </h1>
        <p class="text-gray-600 text-base">
          {{ 'auth.otp.codeSentMessage' | transloco }}
        </p>
        <p class="text-gray-700 font-medium mt-2">{{ emailForm.value.email }}</p>
        }
      </div>

      <!-- Étape 1 : Envoi du code OTP -->
      @if (!otpSent()) {
      <form [formGroup]="emailForm" (ngSubmit)="sendOtp()">
        <div class="flex flex-col gap-6">
          <!-- Champ email -->
          <div class="flex flex-col gap-2">
            <label for="email" class="font-medium text-gray-900 text-sm">
              {{ 'auth.login.emailLabel' | transloco }}
            </label>
            <input
              pInputText
              id="email"
              type="email"
              formControlName="email"
              [placeholder]="'auth.login.emailPlaceholder' | transloco"
              [invalid]="errorMessage() ? true : false"
              class="w-full h-12 text-base"
              autocomplete="email"
              required
              aria-required="true"
              [attr.aria-disabled]="isLoading() ? 'true' : null"
              [attr.aria-invalid]="errorMessage() ? 'true' : null"
              [attr.aria-describedby]="errorMessage() ? 'email-hint email-error' : 'email-hint'"
            />
          </div>

          <!-- Message d'erreur -->
          @if (errorMessage()) {
          <p-message id="email-error" severity="error" role="alert" aria-live="polite">
            {{ errorMessage() }}
          </p-message>
          }

          <!-- Bouton principal moderne -->
          <button
            type="submit"
            [disabled]="isLoading()"
            class="w-full h-12 bg-gradient-to-r from-primary-500 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
          >
            @if (isLoading()) {
            <i class="pi pi-spin pi-spinner" aria-hidden="true"></i>
            } @else {
            <i class="pi pi-envelope" aria-hidden="true"></i>
            }
            <span>{{ 'auth.login.sendCodeButton' | transloco }}</span>
          </button>

          <!-- Indication -->
          <p id="email-hint" class="text-sm text-gray-500 text-center">
            {{ 'auth.login.emailHint' | transloco }}
          </p>
        </div>
      </form>
      }

      <!-- Étape 2 : Vérification du code OTP -->
      @else {
      <form [formGroup]="otpForm" (ngSubmit)="verifyOtp()">
        <div class="flex flex-col gap-6">
          <!-- Champ OTP -->
          <div class="flex flex-col gap-3">
            <label for="otp-input" class="font-medium text-gray-900 text-sm text-center">
              {{ 'auth.otp.codeLabel' | transloco }}
            </label>
            <div class="flex justify-center">
              <p-inputOtp
                inputId="otp-input"
                formControlName="otpCode"
                [length]="6"
                [integerOnly]="true"
                [attr.aria-disabled]="isLoading() ? 'true' : null"
                aria-describedby="otp-description otp-expiry"
                [invalid]="errorMessage() ? true : false"
              />
            </div>
          </div>

          <!-- Message d'erreur -->
          @if (errorMessage()) {
          <p-message severity="error" role="alert" aria-live="polite" styleClass="text-center">
            {{ errorMessage() }}
          </p-message>
          }

          <!-- Bouton principal -->
          <button
            type="submit"
            [disabled]="isLoading()"
            class="w-full h-12 bg-gradient-to-r from-primary-500 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
          >
            @if (isLoading()) {
            <i class="pi pi-spin pi-spinner" aria-hidden="true"></i>
            } @else {
            <i class="pi pi-check" aria-hidden="true"></i>
            }
            <span>{{ 'auth.otp.verifyButton' | transloco }}</span>
          </button>

          <!-- Actions secondaires -->
          <div class="flex flex-col items-center gap-2 pt-4 border-t border-gray-100">
            <p-button
              [label]="'auth.otp.resendButton' | transloco"
              type="button"
              variant="text"
              (click)="sendOtp()"
              [disabled]="isLoading()"
            />
            <p-button
              [label]="'auth.otp.changeEmailButton' | transloco"
              type="button"
              variant="text"
              severity="secondary"
              (click)="resetForm()"
            />
          </div>
        </div>
      </form>
      }
    </div>
  </div>
</div>
